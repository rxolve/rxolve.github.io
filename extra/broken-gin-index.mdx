---
title: "AWS RDS 스케일업 할 때 GIN 인덱스가 끊어지는 현상
date: "240625"
tags: ["AWS", "RDS", "Issue"]
---

- 배경: 어제 RDS 스케일업을 진행했습니다. 인스턴스 타입이 t계열에서 r계열로 변경되었습니다.
- 문제: 오전에 작업을 마치고, 오후에 일부 검색어에 대한 검색이 되지 않는다는 제보가 들어왔습니다.
- 현상: '프로그래' 까지 입력하면 검색이 되지만, '프로그래머'를 입력하면 검색이 되지 않는 식이었습니다.
- 원인: GIN 인덱스가 끊어진 것으로 확인했습니다.
- 해결: 인덱스 재구축

  ```sql
  REINDEX INDEX your_gin_index_name;

  ```

  - 인스턴스 유형을 변경하면 RDS는 새로운 인스턴스를 생성하고 데이터베이스를 마이그레이션합니다.
    - 이 과정에서 인덱스가 손상되는 경우가 있다고 합니다.
    - GIN 인덱스는 구조가 복잡하여 메모리와 디스크 I/O에 민감합니다.

- TODO: 스케일업을 진행할 때는 GIN 인덱스에 대한 테스트가 필요하다는 것을 배웠습니다.
