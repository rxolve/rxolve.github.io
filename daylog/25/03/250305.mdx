---
title: "kube-controller-manager"
date: "250305"
tags: ["Kubernetes"]
---

## kube-controller-manager?

- 중앙 제어 역할:  
  kube-controller-manager는 다양한 컨트롤러(예: 노드, 레플리카, 엔드포인트, 서비스어카운트 컨트롤러 등)를 하나의 프로세스 내에서 실행합니다.  
  각 컨트롤러는 클러스터의 특정 자원을 주시하며, 변화가 감지되면 API 서버에 수정 요청을 보내어 실제 상태를 사용자가 정의한 상태로 맞춥니다.

- 모놀리식 구조:  
  논리적으로는 개별 프로세스처럼 동작하지만, 관리의 복잡성을 줄이기 위해 하나의 바이너리로 컴파일되어 단일 프로세스에서 여러 루프가 동시에 실행됩니다.

## 주요 컨트롤러 종류

1. 노드 컨트롤러 (Node Controller):

   - 모니터링: 5초마다 각 노드의 상태를 확인합니다.
   - 장애 대응: 노드로부터 heartbeat 신호를 40초 동안 받지 못하면 해당 노드를 ‘unreachable’ 상태로 표시하고, 5분 후에도 회복되지 않으면 해당 노드에 할당된 파드들을 다른 노드로 옮깁니다.

2. 레플리케이션(Replica) 컨트롤러:

   - 파드 복제: 사용자가 지정한 파드의 복제 수를 유지하도록 감시하며, 파드가 줄어들면 새로운 파드를 생성합니다.

3. 엔드포인트 컨트롤러:

   - 서비스와 파드 연결: 서비스와 연관된 파드들의 리스트(엔드포인트)를 관리하여, 클라이언트 요청이 올바른 파드로 전달되도록 돕습니다.

4. 서비스어카운트 컨트롤러:
   - 보안 및 인증: 새로운 네임스페이스가 생성될 때 기본 서비스 어카운트를 자동으로 생성합니다.

그 외에도 잡(Job) 컨트롤러, 네임스페이스 컨트롤러 등 다양한 컨트롤러들이 포함되어 있습니다.

## 동작 방식과 구성

- 관찰과 수정 (Watch & Remediate):  
  kube-controller-manager는 API 서버를 통해 클러스터의 리소스 상태를 지속적으로 감시하고, 현재 상태가 사용자가 정의한 사양과 다를 경우, 필요한 작업(예: 파드 생성, 삭제 등)을 API 서버에 요청합니다.

- 배포 방식:  
  대부분의 쿠버네티스 클러스터에서는 kube-controller-manager가 마스터 노드에서 static pod 형식으로 실행되며, 클러스터 초기화 시 자동으로 구성됩니다.

- 설정 옵션:  
  각 컨트롤러의 동작 주기나 타임아웃 등은 kube-controller-manager의 커맨드라인 옵션이나 설정 파일을 통해 조정할 수 있습니다.  
  예를 들어, 노드 모니터링 주기, 그레이스 피리어드, 파드 축출 시간 등은 상황에 맞게 튜닝할 수 있습니다.

## 왜 중요한가?

kube-controller-manager는 클러스터의 안정성과 자가 복구 능력을 보장하는 중추적인 역할을 합니다.  
클러스터 내 리소스들의 원하는 상태를 유지하도록 자동화된 루프를 제공함으로써, 사용자는 시스템 장애나 오류에 대해 걱정할 필요 없이 애플리케이션 개발 및 운영에 집중할 수 있습니다.

## 정리

요약하자면, kube-controller-manager는 다양한 컨트롤러들을 통합하여 클러스터 상태를 지속적으로 감시하고, 사용자가 정의한 원하는 상태를 실현하기 위한 핵심 자동화 엔진입니다.

이처럼 kube-controller-manager는 쿠버네티스의 “자체 치유” 능력을 가능하게 하는 핵심 메커니즘으로, 클러스터의 안정적 운영과 효율적 관리에 필수적인 역할을 수행합니다.
