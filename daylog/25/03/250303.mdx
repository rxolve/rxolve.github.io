---
title: "etcd"
date: "250303"
tags: ["Kubernetes"]
---

## etcd란?

- 분산 키-값 저장소  
  etcd는 CoreOS에서 개발한 오픈소스 분산 키-값 스토어로, 쿠버네티스 클러스터의 설정 데이터, 상태, 메타데이터 등을 저장합니다.
  - 주요 특징:
    - 강한 일관성: Raft 합의 알고리즘을 통해 모든 노드가 동일한 상태를 유지합니다.
    - 고가용성: 홀수 개의 노드(3, 5, 7 등)를 구성해 단일 장애점 없이 클러스터의 데이터를 안정적으로 보관합니다.
    - 경량 및 빠른 성능: 수천 건의 요청을 초당 처리할 수 있을 만큼 최적화되어 있습니다.

## etcd의 아키텍처

- Raft 합의 알고리즘  
  etcd는 Raft 알고리즘을 통해 리더-팔로워 구조로 동작합니다.  
  리더 노드가 쓰기 요청을 처리하고, 변경 사항을 팔로워들에게 복제하여 전체 클러스터의 일관성을 보장합니다.
- 구성요소
  - gRPC 서버: 쿠버네티스 컴포넌트와의 통신을 위해 gRPC 인터페이스를 제공합니다.
  - WAL(Write-Ahead Log): 모든 변경 사항을 기록해 데이터 무결성을 보장하고, 장애 복구 시 사용됩니다.
  - 저장 엔진: 내부적으로 B+트리 기반의 저장 구조를 사용해 키-값 데이터를 효율적으로 관리합니다.
  - MVCC (다중 버전 동시성 제어): 여러 버전의 데이터를 동시에 관리하여 스냅샷 및 히스토리 조회 기능을 지원합니다.

## 쿠버네티스와의 상호작용

- API 서버와의 연계  
  쿠버네티스 API 서버는 etcd에 클러스터 상태(예: 파드, 서비스, ConfigMap 등)를 저장하고 업데이트합니다.
  - 예를 들어, 사용자가 `kubectl apply`로 파드를 생성하면 API 서버가 원하는 상태를 etcd에 기록하고, 컨트롤러들이 이를 감지하여 실제 파드가 생성됩니다.
- 워치(Watch) 메커니즘  
  쿠버네티스의 컨트롤러들은 etcd의 Watch 기능을 활용해 클러스터 상태의 변경을 실시간으로 감지, 필요한 조치를 즉각 수행합니다.

## 운영 및 보안 고려사항

- 백업/복원  
  etcd는 쿠버네티스 클러스터의 단일 진실 원천(Source of Truth)이므로 정기적인 스냅샷 백업과 복원 절차가 필수입니다.
- 보안 강화
  - TLS/SSL: etcd와 클라이언트 간 통신을 암호화해 데이터 유출을 방지합니다.
  - RBAC: 최소 권한 원칙을 적용해, API 서버 외의 접근을 철저히 제한합니다.
- 리소스 관리  
  충분한 CPU, 메모리, SSD 기반 스토리지를 확보해 etcd의 고성능과 안정성을 유지해야 합니다.

### 정리

etcd는 쿠버네티스 클러스터의 상태를 ‘단 한 곳’에서 관리하는 중요한 데이터 저장소입니다.  
강한 일관성과 분산 처리 능력을 바탕으로 클러스터 전체의 안정성과 확장성을 보장하며, 이를 통해 쿠버네티스가 동적인 환경에서 자동 복구와 스케일링을 수행할 수 있도록 지원합니다.

실제 운영 환경에서는 백업, 보안, 리소스 최적화 등 다양한 운영 전략을 함께 고려해야 합니다.  
이러한 내용을 잘 이해하고 적용하면, 쿠버네티스 클러스터의 안정성과 신뢰성을 크게 향상시킬 수 있습니다.
