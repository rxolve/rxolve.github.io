---
title: "구조적 동시성"
date: "250208"
tags: ["Concept"]
---

구조적 동시성은 비동기 프로그래밍에서 여러 태스크(작업)를 명확한 범위 내에서 그룹화하여 관리하는 패턴입니다.

쉽게 말해, 어떤 부모 작업이 자식 작업들을 생성하면, 부모 작업이 끝나기 전에 자식 작업들이 모두 완료되도록 보장하는 방식을 말합니다.

#### 특징

- 명확한 라이프사이클 관리

  부모 함수나 블록 내에서 생성된 모든 비동기 태스크는 그 범위가 끝나기 전에 완료되어야 합니다.

  이렇게 하면 "떠돌이 태스크"가 생기지 않고, 실행 흐름이 예측 가능해집니다.

- 에러 전파 및 취소 처리

  만약 자식 태스크 중 하나라도 예외가 발생하면, 구조적 동시성 메커니즘은 해당 예외를 부모에게 전파하거나 전체 태스크 그룹을 취소할 수 있도록 도와줍니다.

  이로 인해 복잡한 에러 처리 로직을 단순화할 수 있습니다.

- 코드의 가독성과 유지보수성 향상

  비동기 작업들을 한 곳에 묶어 관리함으로써, 코드의 흐름이 명확해지고, 디버깅 및 유지보수가 쉬워집니다.

#### 예시 (Python Trio의 nursery 개념)

Python의 Trio 라이브러리는 구조적 동시성의 좋은 예입니다.

Trio에서는 `async with trio.open_nursery() as nursery:` 구문을 사용하여,

nursery 내에서 시작된 모든 태스크가 반드시 완료될 때까지 대기합니다.

```python
import trio

async def child_task(name):
    print(f"{name} 시작됨")
    await trio.sleep(1)
    print(f"{name} 완료됨")

async def main():
    async with trio.open_nursery() as nursery:
        nursery.start_soon(child_task, "태스크 1")
        nursery.start_soon(child_task, "태스크 2")

trio.run(main)
```

이 예제에서 `main` 함수는 nursery를 열고, 그 안에서 두 개의 태스크를 동시에 시작합니다.

nursery는 두 태스크가 모두 완료되기 전에는 `main` 함수가 종료되지 않도록 보장합니다.

#### 결론

구조적 동시성은 비동기 작업을 명확한 범위 내에서 관리하여, 에러 처리와 태스크 취소를 효과적으로 수행할 수 있게 해줍니다.

이러한 패턴은 코드의 안정성과 가독성을 높이고, 복잡한 비동기 로직을 보다 예측 가능하게 만들어 줍니다.
