---
title: "Paxos 알고리즘"
date: "250127"
tags: ["Algorithm"]
---

## 분산 합의 문제와 Paxos의 필요성

분산 환경에서는 여러 노드가 동일한 상태나 명령어 순서를 유지해야 합니다.  
예를 들어, 데이터베이스의 로그 복제나 리더 선출 과정에서 합의(consensus)는 필수적입니다.  
하지만 네트워크 지연, 메시지 손실, 노드의 장애 등 다양한 장애 상황 속에서 합의를 보장하는 것은 매우 어려운 문제입니다.  
Paxos는 안정성(safety)—즉, 두 노드가 서로 다른 결정을 내리지 않도록 보장하는—와 진행(liveness) 사이의 균형을 이루면서 안전한 합의를 달성하는 방법을 제시합니다.  
FLP 이론에 따르면 완전한 비동기 시스템에서 결정을 보장하기는 어렵지만, Paxos는 대부분의 경우에서 안전성을 최우선으로 보장합니다.

## Paxos의 주요 역할

Paxos는 세 가지 기본 역할을 정의합니다.

- Proposer (제안자): 클라이언트의 요청을 받아 제안(proposal)을 시작합니다. 여러 제안자가 동시에 존재할 수 있으나, 합의가 이루어지기 위해서는 결국 하나의 값으로 수렴해야 합니다.
- Acceptor (수락자): 제안된 값을 ‘수락(accept)’하는 역할을 하며, 다수의 수락자가 동일한 값에 대해 수락해야 그 값이 최종적으로 선택됩니다.
- Learner (학습자): 최종적으로 선택된 값을 학습하여, 이를 기반으로 실제 작업(예: 상태 머신 업데이트)을 수행합니다.

실제 시스템에서는 하나의 노드가 이 역할들을 동시에 수행하기도 합니다.

## Paxos의 두 단계 프로토콜

Paxos는 두 개의 주요 단계로 구성됩니다.

#### Phase 1 – 준비(Prepare) 및 약속(Promise)

- Prepare 요청: 제안자는 고유하고 증가하는 번호(N)를 선택하여, 다수의 수락자에게 _prepare(N)_ 메시지를 전송합니다.
- Promise 응답: 수락자는 받은 번호가 지금까지 본 제안 번호보다 크다면, 앞으로 N보다 작은 번호의 제안을 무시하겠다는 약속(_promise_)과 함께, 이전에 수락한 제안이 있다면 그 번호와 값을 응답합니다.

이 단계는 수락자들이 어떤 제안이 이전에 있었는지 정보를 공유하도록 하는 역할을 하며, 나중 단계에서 일관성을 유지하는 데 중요한 기반이 됩니다.

#### Phase 2 – 수락(Accept) 및 결정(Decide)

- Accept 요청: 제안자는 Phase 1에서 다수의 수락자로부터 응답을 받으면, 이전에 수락한 값 중 가장 높은 번호에 해당하는 값을 사용하거나(이미 수락된 값이 있다면) 자신이 원하는 값을 선택하여 _accept(N, v)_ 메시지를 전송합니다.
- Accepted 응답: 수락자는 만약 이전에 약속한 번호보다 큰 제안이 오지 않았다면, 해당 제안을 수락하고, 이를 응답합니다.

수락자가 다수(Quorum)로부터 해당 제안을 수락하면, 그 값이 최종적으로 선택(chosen)되며 학습자에게 전파됩니다.

## 실제 구현에서의 고려사항

- 다중 제안자 문제: 여러 제안자가 동시에 제안을 시작하면 서로 충돌하여 “제안 번호 전쟁”이 발생할 수 있습니다. 이러한 상황에서는 리더 선출 또는 지수 백오프 같은 추가 메커니즘으로 해결합니다.
- Quorum의 중요성: Paxos는 두 개의 다수 집합(Quorum)이 반드시 교집합을 가져야 한다는 점에 의존합니다. 이를 통해 이전 단계의 정보를 잃지 않고 일관성을 유지할 수 있습니다.
- 리더 최적화 (Multi-Paxos): 안정적인 리더가 존재하면 Phase 1의 준비 단계를 여러 번 반복할 필요 없이, 후속 제안은 Phase 2만 실행함으로써 메시지 지연을 줄이고 성능을 향상시킬 수 있습니다.
- 안정성과 진행: Paxos는 안전성은 항상 보장하지만, 극단적인 네트워크 지연이나 충돌 상황에서는 진행(liveness)이 지연될 수 있습니다.

## 정리

Paxos는 분산 환경에서 합의를 이루기 위한 기본적이면서도 강력한 알고리즘입니다.  
네트워크의 불확실성과 노드의 장애 상황 속에서도 모든 정상 노드가 동일한 값을 결정하도록 보장하는 Paxos의 메커니즘은, 데이터베이스 복제, 분산 락 서비스, 리더 선출 등 다양한 실제 시스템에서 핵심 역할을 수행하고 있습니다.  
이 알고리즘의 이해는 복잡해 보일 수 있지만, 핵심 원리를 파악하면 분산 시스템의 설계와 문제 해결에 큰 도움이 됩니다.
