---
title: "N-Queens Problem"
date: "240822"
tags: ["Algorithm"]
---

## N-Queens Problem이란?

N-Queens Problem은 N x N 크기의 체스판에 N개의 퀸을 서로 공격할 수 없는 위치에 배치하는 문제입니다.

퀸은 같은 행, 열, 또는 대각선상에 있는 다른 퀸을 공격할 수 있습니다.

## 백트래킹

백트래킹은 가능한 모든 조합을 시도하면서 조건에 맞지 않는 경우 즉시 되돌아가는(백트래킹) 방식으로 문제를 해결합니다.

이 방법은 브루트 포스(전수 조사)보다 효율적이며, 불필요한 탐색을 줄일 수 있습니다.

## 구현 코드

```typescript
const solveNQueens = (n: number): string[][] => {
  const board: string[][] = Array(n)
    .fill(null)
    .map(() => Array(n).fill("."));
  const result: string[][] = [];

  const isValid = (row: number, col: number): boolean => {
    // 같은 열에 퀸이 있는지 확인
    for (let i = 0; i < row; i++) {
      if (board[i][col] === "Q") return false;
    }

    // 왼쪽 상단 대각선 확인
    for (let i = row - 1, j = col - 1; i >= 0 && j >= 0; i--, j--) {
      if (board[i][j] === "Q") return false;
    }

    // 오른쪽 상단 대각선 확인
    for (let i = row - 1, j = col + 1; i >= 0 && j < n; i--, j++) {
      if (board[i][j] === "Q") return false;
    }

    return true;
  };

  const backtrack = (row: number): void => {
    if (row === n) {
      result.push(board.map((row) => row.join("")));
      return;
    }

    for (let col = 0; col < n; col++) {
      if (isValid(row, col)) {
        board[row][col] = "Q";
        backtrack(row + 1);
        board[row][col] = "."; // 백트래킹
      }
    }
  };

  backtrack(0);
  return result;
};

console.log(solveNQueens(8)); // 92
```

## 코드 설명

1. `solveNQueens` 함수는 체스판의 크기 `n`을 입력받아 가능한 모든 해답을 반환합니다.

2. `board`는 현재의 체스판 상태를 나타냅니다. 초기에는 모든 칸이 '.'으로 채워집니다.

3. `isValid` 함수는 주어진 위치(row, col)에 퀸을 놓을 수 있는지 확인합니다.

   - 같은 열에 다른 퀸이 있는지 확인
   - 왼쪽 상단 대각선에 다른 퀸이 있는지 확인
   - 오른쪽 상단 대각선에 다른 퀸이 있는지 확인
   - 다른 조건을 판단하지 않아도 되는 이유는, 퀸을 놓을 때 한 행에 하나씩만 놓기 때문입니다.

4. `backtrack` 함수는 실제 백트래킹을 수행합니다.
   - 만약 현재 행(row)이 n과 같다면, 모든 퀸을 성공적으로 배치한 것이므로 결과에 추가합니다.
   - 그렇지 않다면, 현재 행의 각 열에 대해
     - 해당 위치가 유효하다면 퀸을 놓고 (`board[row][col] = 'Q'`)
     - 다음 행으로 재귀 호출합니다. (`backtrack(row + 1)`)
     - 재귀 호출이 끝나면 퀸을 제거합니다. (`board[row][col] = '.'`) \<- 이것이 백트래킹입니다!

## 백트래킹 과정 상세 설명

백트래킹의 핵심은 "시도 → 실패 → 되돌아가기"의 과정입니다.

N-Queens Problem에서 이 과정은 다음과 같이 진행됩니다.

1. 첫 번째 행의 첫 번째 열에 퀸을 놓습니다.
2. 두 번째 행으로 이동하여 가능한 위치에 퀸을 놓습니다.
3. 이 과정을 반복하며 마지막 행까지 도달하거나, 더 이상 퀸을 놓을 수 없을 때까지 진행합니다.
4. 마지막 행에 도달하면 해답을 찾은 것이므로 결과에 추가합니다.
5. 더 이상 퀸을 놓을 수 없다면, 직전에 놓은 퀸을 제거하고 다른 위치에 놓아봅니다.
6. 모든 가능성을 시도할 때까지 이 과정을 반복합니다.

8-Queens Problem의 해답은 다음과 같습니다.

```
1. Q . . . . . . .   2. . . Q . . . . .   3. . . . . Q . . .   4. . . . . . . Q .
   . . . . . . Q .      . . . . . Q . .      . . . Q . . . .      . . . Q . . . .
   . . . Q . . . .      . Q . . . . . .      . Q . . . . . .      . . . . . Q . .
   . . . . . Q . .      . . . . . . . Q      . . . . . . Q .      . . . . . . Q .
   . Q . . . . . .      . . . Q . . . .      Q . . . . . . .      . . . . . Q . .
   . . . . Q . . .      . . . . . Q . .      . . . . . . . Q      . . Q . . . . .
   . . . . . . Q .      Q . . . . . . .      . . Q . . . . .      . Q . . . . . .
   . . Q . . . . .      . . . . Q . . .      . . . . Q . . .      Q . . . . . . .

5. . . . Q . . . .   6. . Q . . . . . .   7. . . Q . . . . .   8. Q . . . . . . .
   . . . . . . . Q      . . . Q . . . .      . . . . Q . . .      . . . . . Q . .
   . . . . . Q . .      Q . . . . . . .      . . . . . Q . .      . . Q . . . . .
   . . Q . . . . .      . . . . . . Q .      Q . . . . . . .      . . . . Q . . .
   . . . . Q . . .      . . . . Q . . .      . Q . . . . . .      . . . Q . . . .
   Q . . . . . . .      . . . . . Q . .      . . Q . . . . .      . . . . . . Q .
   . . . Q . . . .      . . Q . . . . .      . . . Q . . . .      . . . . . Q . .
   . . . . . Q . .      . . . . . . Q .      . . . . . . Q .      . Q . . . . . .

9. . . Q . . . . .   10. Q . . . . . . .   11. . . . . Q . . .   12. . . Q . . . .
    . . . . . Q . .       . . . . Q . . .       Q . . . . . . .       . . . . Q . .
    Q . . . . . . .       . Q . . . . . .       . . Q . . . . .       Q . . . . . .
    . . . . . . Q .       . . . . . . Q .       . . . . Q . . .       . . . . . Q .
    . . . . Q . . .       . . Q . . . . .       . Q . . . . . .       . . . . . . Q
    . Q . . . . . .       . . . . . Q . .       . . . Q . . . .       . . Q . . . .
    . . . Q . . . .       . . . Q . . . .       . . . . . Q . .       . Q . . . . .
    . . . . . . . Q       . . . . . . . Q       . . . . . . . Q       . . . Q . . .
```

위와 같이 12개의 기본 형태가 있으며, 이를 근본해라고 합니다.

대칭인 마지막 패턴(4개, 180도 회전과 상하대칭이 겹침)을 제외하고 각 8개를 회전(4개) 및 대칭이동(4개) 으로 만들 수 있으므로, 여덟 퀸의 경우 총 92개의 해가 있습니다.

## 시간 복잡도

N-Queens Problem의 시간 복잡도는 O(N!)입니다.

N이 15 이하일 때는 빠르게 동작하지만, N이 15를 넘어가면 시간이 오래 걸립니다.

따라서 N이 15 이상일 때는 다른 방법을 사용해야 합니다. (예: 비트마스크, 백트래킹 최적화 등)

## 참고 자료

나무위키: [여덟 퀸 문제](https://namu.wiki/w/%EC%97%AC%EB%8D%9F%20%ED%80%B8%20%EB%AC%B8%EC%A0%9C)
