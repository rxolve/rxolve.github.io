---
title: "람다를 따뜻하게 유지하는 방법"
date: "240925"
tags: ["AWS"]
---

지난번에 람다의 비용적인 이점을 살펴봤습니다.

서버리스 아키텍처, 특히 람다를 이용한 서버리스 환경은 비용 절감과 확장성 측면에서 많은 장점을 제공하지만, 단점도 존재합니다.

람다 기반의 서버리스 아키텍처를 도입할 때 고려해야 할 몇 가지 단점을 살펴보겠습니다.

## 람다의 단점

#### 콜드 스타트 문제

람다는 기본적으로 서버리스 환경에서 코드가 실행될 때마다 새로운 컨테이너를 생성해 그 안에서 코드를 실행합니다.

이 과정에서 코드가 초기화되고 필요한 리소스를 설정하는 시간이 발생하는데, 이 시간을 콜드 스타트라고 합니다.

특히 트래픽이 일정하지 않을 때, 즉 오랫동안 요청이 없다가 갑작스러운 호출이 발생하면 이 초기화 시간이 길어져 성능 저하를 유발할 수 있습니다.

보통 노드나 파이썬과 같은 인터프리터 기반 언어는 콜드 스타트 시간이 짧지만, 자바나 C++ 같은 컴파일 언어는 초기화에 더 많은 시간이 필요합니다.

#### 제한된 실행 시간

람다 함수는 기본적으로 최대 15분의 실행 시간을 가집니다.

따라서, 장시간 실행되는 작업이나 대규모 배치 작업의 경우 람다로는 처리하기 어렵습니다.

#### VPC 관련 성능 문제

람다 함수가 VPC 내부 자원(예: RDS 등)에 접근해야 할 때, ENI(Elastic Network Interface)를 설정하는 시간이 추가로 필요합니다.

이로 인해 람다 함수의 초기화 시간이 더 길어질 수 있습니다.

#### 모니터링 및 디버깅의 어려움

서버리스 아키텍처에서는 서버에 직접 접근할 수 없기 때문에, 디버깅이나 로깅이 더 어렵습니다.

로그와 메트릭은 클라우드와치 등을 통해 확인할 수 있지만, 실시간으로 디버깅하거나 문제를 추적하기가 까다롭습니다.

#### 고정된 컴퓨팅 자원

람다 함수는 CPU와 메모리가 비례해서 자동 할당되며, 이를 수동으로 조정할 수 있는 옵션이 제한적입니다.

대용량 연산(예: 대규모 데이터 처리, 머신러닝 모델 실행 등)이나 CPU 집약적인 작업에서는 람다의 컴퓨팅 자원이 충분하지 않을 수 있습니다.

## 콛드 스타트 문제 해결

이중에서 콜드 스타트 문제를 해결하는 일반적인 방법을 알아보겠습니다.

람다를 항상 '따뜻한' 상태로 유지하면 됩니다. 바로 Warm-Up 패턴이 그 해결책입니다.

#### Warm-Up 패턴이란?

Warm-Up 패턴은 람다 인스턴스가 종료되기 전에 주기적으로 호출을 하여, 항상 인스턴스가 준비된 상태로 유지되도록 만드는 방법입니다.

트래픽이 적은 시간에도 인스턴스가 종료되지 않도록 주기적인 핑을 보내 인스턴스를 '따뜻하게' 유지하는 것이 핵심입니다.

람다 인스턴스는 일정 시간(보통 5분~15분) 동안 요청이 없으면 종료됩니다.

이 시간 안에 다시 호출이 발생하면 인스턴스는 그대로 유지되어 콜드 스타트 없이 빠르게 응답할 수 있게 됩니다.

몇가지 Warm-Up 패턴을 살펴보겠습니다.

#### CloudWatch Events를 통한 주기적 호출

가장 간단한 방법은 AWS CloudWatch Events를 이용해 일정 주기로 람다를 호출하는 것입니다.

1분 간격으로 람다를 호출하도록 설정하면, 람다 인스턴스가 계속 유지되면서 콜드 스타트가 발생하지 않게 됩니다.

이 호출은 실제 비즈니스 로직을 실행할 필요는 없으며, 단순히 람다 인스턴스를 활성화 상태로 유지하기 위한 것입니다.

#### Warm-Up 요청을 위한 핸들러 추가

람다 함수 내에서 주기적 호출이 일반 요청과 혼동되지 않도록 `warm-up` 핸들러를 추가할 수 있습니다.

이 핸들러는 특정 파라미터나 헤더를 통해 요청이 단순히 인스턴스를 깨우기 위한 것임을 식별하고, 실제 비즈니스 로직을 생략하도록 할 수 있습니다.

```typescript
export const handler = async (event) => {
  // Keep-alive 여부 확인
  if (event.source === "serverless-warmup-plugin") {
    console.log("Warm up request - keeping Lambda instance alive");
    return;
  }

  // 실제 비즈니스 로직 처리
  // ...
};
```

이와 같은 방식으로 Keep-Alive 요청을 일반 트래픽과 분리하여 처리하면, 불필요한 연산을 방지하고 성능을 최적화할 수 있습니다.

#### Serverless Framework 플러그인 활용

만약 Serverless Framework를 사용하고 있다면, [serverless-plugin-warmup](https://github.com/FidelLimited/serverless-plugin-warmup)이라는 유용한 플러그인을 통해 자동으로 주기적인 Warm-Up을 설정할 수 있습니다.

```yaml
plugins:
  - serverless-plugin-warmup

custom:
  warmup:
    enabled: true
    events:
      - schedule: rate(1 minutes)

functions:
  my람다Function:
    warmup: true
```

이 플러그인을 사용하면 별도의 CloudWatch 설정 없이도 쉽게 Warm-Up 패턴을 적용할 수 있습니다.

## 정리하며

람다의 콜드 스타트는 서버리스 환경에서의 큰 단점 중 하나지만, Warm-Up 패턴을 통해 이 문제를 효과적으로 완화할 수 있습니다.

다만 비용과 성능을 비교해보고, 서비스 특성에 맞는 최적의 해결책을 선택하는 것이 중요합니다.

Provisioned Concurrency와 같은 다른 옵션도 고려하면서 트래픽에 맞는 최적화를 고민해 보는 것이 좋습니다.
