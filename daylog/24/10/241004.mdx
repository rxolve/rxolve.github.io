---
title: "카프카와 레디스를 이용한 이벤트 기반 아키텍처"
date: "241004"
tags: ["Tool"]
---

> 슬래시 강연을 보다 카프카와 레디스에 대해 정리할 필요가 있다는 생각이 들었습니다.

마이크로서비스 아키텍처가 확산되면서 비동기 통신과 이벤트 기반 아키텍처는 현대 시스템에서 필수적인 요소로 자리 잡았습니다.

이에 따라 많은 기업에서 분산 메시지 처리 시스템을 고려하게 되며, 대표적으로 Apache Kafka와 Redis가 있습니다.

카프카와 레디스의 특징을 비교하고, 함께 사용했을 때의 이점을 알아보겠습니다.

## Apache Kafka

Kafka는 분산형 메시지 스트리밍 플랫폼으로 대규모 데이터 스트리밍과 이벤트 처리를 목적으로 설계되었습니다.

주로 대용량 트래픽과 분산 처리가 필요한 환경에서 사용됩니다.

#### Kafka의 주요 개념

- Producer와 Consumer: 메시지를 생성하고, 소비하는 클라이언트로 구성됩니다.
- Topic: 메시지가 모이는 논리적 구분 단위입니다.
- Partition: 각 Topic은 여러 Partition으로 나뉘어 병렬 처리가 가능하게 됩니다.
- Broker: 메시지를 저장하고 관리하는 서버입니다.

#### Kafka의 장점

- 높은 내구성: 데이터를 디스크에 저장하고 복제본을 만들어 데이터 손실을 최소화합니다.
- 확장성: 수평 확장이 가능해 다수의 브로커와 파티션으로 확장할 수 있습니다.
- 메시지 순서 보장: 파티션 내에서 메시지 순서를 보장하여, 이벤트 흐름 제어가 용이합니다.

#### Kafka의 단점

- 설정과 운영이 복잡하고 관리가 필요합니다.
- 소규모 프로젝트나 간단한 메시지 처리에는 다소 과할 수 있습니다.

## Redis

Redis는 인메모리 데이터 저장소로, 빠른 데이터 조회와 캐시로 유명합니다.

Redis는 Redis Streams와 Pub/Sub을 통해 간단한 메시지 큐로도 활용할 수 있지만, 기본적으로 짧은 수명 주기의 데이터 처리에 적합합니다.

#### Redis의 주요 개념

- In-Memory Storage: Redis는 데이터를 메모리에 저장해 매우 빠른 조회 속도를 제공합니다.
- Pub/Sub: 간단한 메시지 전송 시스템으로 사용할 수 있습니다.
- Redis Streams: 스트리밍 데이터 처리 기능으로, 데이터 순차 처리가 가능하지만 Kafka와 같은 고급 기능은 없습니다.

#### Redis의 장점

1. 빠른 처리 속도: 인메모리 기반으로 데이터 읽기/쓰기 속도가 매우 빠릅니다.
2. 간단한 설정과 사용: 설정과 사용이 쉬워 빠르게 구축할 수 있습니다.
3. 간편한 Pub/Sub 기능: 실시간 알림과 같은 간단한 메시징 서비스에 적합합니다.

#### Redis의 단점

- 메모리 기반으로 데이터 내구성이 낮고, 대규모 데이터 저장에는 적합하지 않습니다.
- Kafka의 수준에 맞는 고급 메시지 스트리밍 기능이 부족합니다.

## Kafka와 Redis의 차이점 정리

| 기능             | Kafka                                               | Redis                                              |
| ---------------- | --------------------------------------------------- | -------------------------------------------------- |
| 주요 목적        | 대규모 이벤트 스트리밍, 분산 메시징                 | 실시간 데이터 조회, 캐시, 짧은 수명의 메시징       |
| 데이터 저장 방식 | 디스크 기반 영구 저장                               | 인메모리 저장 (필요 시 디스크 영구화 가능)         |
| 확장성           | 수평 확장이 뛰어나 대규모 데이터 처리에 적합        | 메모리 용량에 제한이 있어 대규모 데이터에는 부적합 |
| 내구성           | 높은 내구성으로 데이터 손실 위험이 적음             | 낮은 내구성, 데이터 손실 위험이 있음               |
| 적합한 사용 사례 | 마이크로서비스 간 이벤트 스트리밍, 실시간 로그 수집 | 사용자 세션 관리, 캐시, 비동기 작업 큐 관리        |

## Kafka와 Redis를 함께 사용하는 이점

카프카와 레디스는 각기 다른 강점을 가지고 있기 때문에 함께 사용했을 때 시너지를 극대화할 수 있습니다.

분산 환경에서의 대규모 이벤트 스트리밍과 실시간 데이터 처리, 빠른 데이터 조회 요구 사항을 모두 충족시킬 수 있기 때문에, 이 두 시스템을 조합해 활용하는 방식은 마이크로서비스 아키텍처나 이벤트 기반 시스템에서 매우 유용합니다.

Kafka는 영구 저장과 대규모 분산 처리를 담당하고, Redis는 빠른 조회와 캐싱을 통해 실시간 응답 성능을 보완합니다.

사례를 소개해보겠습니다.

#### 높은 성능의 실시간 데이터 스트리밍

Kafka는 대규모 이벤트 스트리밍과 비동기 메시징을 안정적으로 관리합니다.

하지만, 데이터를 디스크에 영구 저장하기 때문에 실시간으로 높은 처리량을 보장하면서도 빠른 응답이 필요할 경우 지연 시간이 발생할 수 있습니다.

이럴 때 Redis를 추가로 사용하면 데이터를 메모리에 캐싱하여 즉각적인 응답 성능을 제공할 수 있습니다.

- 예시: 실시간 금융 트랜잭션 데이터에서 Kafka는 모든 거래를 수집하고 처리하는 동안 Redis는 최근 거래 내역을 메모리에 저장해 빠르게 조회할 수 있습니다.

#### 즉각적인 상태 조회와 비동기 작업 처리 분리

Kafka를 통해 비동기 작업을 트리거하면서 Redis에 최신 상태를 저장하면, 비동기 작업이 완료되기 전에 현재 상태를 바로 확인할 수 있습니다.

이는 실시간 피드백이 필요한 서비스에서 큰 장점입니다.

- 예시: 주문 처리 시스템에서 주문 요청이 들어오면 Kafka는 비동기로 주문을 처리하고, Redis는 주문의 현재 상태(예: “처리 중”, “완료”)를 빠르게 제공합니다. 클라이언트는 Redis에서 현재 상태를 즉시 조회할 수 있어, 사용자 경험이 개선됩니다.

#### 중간 캐시 역할을 통한 Kafka 부하 감소

Kafka가 많은 Consumer와 연결되어 있어 부하가 과중할 경우 Redis를 중간 캐시로 활용할 수 있습니다.

Redis가 가장 자주 요청되는 데이터를 캐싱해 Kafka에 대한 직접적인 조회를 줄여주면, Kafka의 리소스를 아끼고 성능을 최적화할 수 있습니다.

- 예시: Kafka를 통해 수집된 데이터 중 인기 있는 데이터나 최근 발생한 이벤트를 Redis에 저장해두고, 각 서비스가 Redis에 접근하여 데이터를 빠르게 조회하도록 합니다. 이 방식은 Kafka의 부하를 줄이면서 데이터 접근 속도를 높여줍니다.

#### 데이터 복구 및 실시간 모니터링 개선

Kafka는 영구 데이터를 보관하여 이벤트 로그나 오류가 발생했을 때 쉽게 복구할 수 있는 장점이 있습니다.

이를 Redis에 연동하여 중요한 데이터를 실시간으로 캐싱하고 모니터링하면 신속한 문제 감지와 복구가 가능합니다.

- 예시: 실시간 로그 모니터링 시스템에서 Kafka는 전체 로그를 수집해 보관하고, Redis는 최근 발생한 에러 메시지나 중요한 이벤트 로그를 캐시해 관리 콘솔에서 실시간으로 확인하도록 지원합니다.

#### 작업 스케줄링과 상태 관리의 단순화

Kafka의 메시지 큐와 비동기 처리 기능에 Redis의 작업 상태 저장을 조합하면, 복잡한 작업 스케줄링을 단순화할 수 있습니다.

Kafka는 여러 서비스 간의 작업을 비동기적으로 전달하고, Redis는 현재 작업 상태나 결과를 임시로 저장해 빠르게 확인할 수 있도록 해줍니다.

- 예시: 비디오 인코딩 서비스에서 Kafka는 인코딩 요청을 분산 처리하도록 전송하고, Redis는 각 인코딩 작업의 상태를 저장해 작업 관리 대시보드에서 쉽게 모니터링할 수 있게 합니다.

### 정리하며

Kafka와 Redis는 분산 처리와 실시간 성능을 보장할 수 있는 각기 다른 기능을 제공하며, 함께 사용할 때 전체 시스템의 성능과 확장성을 높이는 시너지를 발휘할 수 있습니다.

Kafka는 내구성 높은 메시지 스트리밍과 이벤트 관리의 중심이 되고, Redis는 실시간 응답이 필요한 작업과 캐싱을 담당하며 빠른 데이터 조회를 돕습니다.

이렇게 두 시스템을 함께 활용하는 것은 고성능과 확장성, 데이터 일관성을 유지하면서도 실시간 처리 요구를 충족할 수 있는 효과적인 접근법입니다.
