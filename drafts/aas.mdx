---
title: "Average Active Sessions (AAS)"
date: "241023"
tags: ["RDS"]
---

RDS를 모니터링하다 `wait(AAS)별 로드`라는 지표를 보게 되었습니다.

처음 보는 개념이기에 정리해봅니다.

## AAS란?

AAS는 쉽게 말해 "동시에 몇 명이 데이터베이스에서 뭔가를 하고 있나?"를 보여주는 지표입니다.

- AAS가 1이라면? → 한 명이 열심히 일하는 중.
- AAS가 2라면? → 두 명이 동시에 뭔가를 처리하고 있는 것입니다.

이렇게 AAS가 높아질수록, 데이터베이스가 점점 바빠집니다.

문제는 AAS가 너무 높아지면 데이터베이스가 일을 감당하지 못하고 느려지는 현상이 발생합니다.

카페에서 한 명의 바리스타가 주문을 소화하는 상황을 상상해 볼 수 있습니다.

손님이 한두 명일 때는 괜찮지만, 갑자기 열 명이 줄을 서면 바리스타도 당황할 것입니다.

## AAS가 어느 정도면 괜찮을까요?

AAS 수치가 어느 정도면 적절한지 기준을 간단히 정리해 드리겠습니다.

- 1 이하: 여유가 넘쳐요. 일 좀 더 줘도 되겠네요.
- 1 ~ 2: 괜찮아요. 적당한 부하로 잘 돌아가고 있어요.

## AAS를 어떻게 측정하죠?

RDS에서는 우리가 직접 계산하기보단 CloudWatch와 Performance Insights 같은 도구를 이용해 AAS를 확인할 수 있습니다.

#### CloudWatch 메트릭으로 대략적인 AAS 계산하기

CloudWatch에서는 CPU 사용률을 가지고 간단하게 AAS를 예측할 수 있습니다.

- 공식: `(CPUUtilization / 100) * vCPU 개수`  
  예를 들어, vCPU가 4개인데 CPU 사용률이 50%면?
  - `50 / 100 * 4 = 2`  
    AAS가 2라는 뜻입니다. 두 개의 세션이 동시에 일을 처리하고 있다는 의미입니다.

#### Performance Insights로 쉽게 보기

Performance Insights는 AAS를 자동으로 계산해줍니다.

여기서는 AAS를 시간대별로 시각화해서 볼 수 있고, 어디에서 병목이 생기는지 쉽게 파악할 수 있습니다.

예를 들어, CPU, IO, 락 대기 시간 등으로 나눠서 분석이 가능합니다.

## AAS가 높은 경우, 문제를 어떻게 해결하나요?

AAS가 높아졌을 때는 원인을 잘 찾아야 합니다. 주로 세 가지 이유가 있습니다.

1. CPU 대기 시간이 높은 경우

   - CPU 자원이 부족하거나 쿼리가 비효율적일 때 발생합니다.
   - 인스턴스 업그레이드나 쿼리 최적화가 필요합니다.

2. IO 대기 시간이 높을 때

   - 디스크 읽기/쓰기가 느리다는 신호입니다.
   - 스토리지 성능 업그레이드가 필요할 수 있습니다.

3. 락 대기 시간이 높다면?
   - 여러 트랜잭션이 같은 데이터를 동시에 쓰려고 할 때 발생합니다.
   - 쿼리나 트랜잭션 구조 개선을 고민해야 합니다.

## AAS 관리로 데이터베이스 성능 최적화하기

AAS를 꾸준히 모니터링하고 문제를 발견하면 미리 대비할 수 있습니다.

아래와 같은 방법으로 최적화할 수 있습니다.

- 자동 스케일링: 트래픽이 많아지면 자동으로 인스턴스 확장.
- 쿼리 최적화: 비효율적인 쿼리를 찾아 개선.
- 캐시 도입: Redis 같은 캐시를 이용해 자주 쓰는 데이터는 DB를 거치지 않고 제공.
- 읽기 전용 복제본: 읽기 부하를 줄이기 위해 사용.
