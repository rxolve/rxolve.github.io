---
title: "npm vs npx"
date: "240826"
tags: ["Tool"]
---

Node.js 생태계에서 npm(Node Package Manager)은 오랫동안 필수 도구로 자리잡아 왔습니다.

그러나 npx가 등장한 이후, 많은 개발자들이 이 두 도구의 차이점과 각각의 사용 시나리오에 대해 혼란을 겪고 있습니다.

오늘은 npm과 npx의 차이점을 심층적으로 살펴보고, 각 도구의 내부 동작 원리와 최적의 사용 사례를 분석해 보겠습니다.

## npm: 패키지 관리의 기본

npm은 Node.js의 기본 패키지 관리자로, 주로 다음과 같은 작업을 수행합니다:

1. 의존성 관리
2. 패키지 설치 (로컬 또는 전역)
3. 버전 관리
4. 스크립트 실행

npm의 핵심 기능은 `package.json` 파일을 통한 프로젝트 의존성 관리입니다. 이는 프로젝트의 재현성과 일관성을 보장하는 데 중요한 역할을 합니다.

### npm의 내부 동작

npm이 패키지를 설치할 때 일어나는 일을 간단히 살펴보겠습니다:

1. 의존성 해결: `package.json`에 명시된 의존성을 분석합니다.
2. 패키지 다운로드: npm 레지스트리에서 필요한 패키지를 다운로드합니다.
3. 압축 해제 및 설치: 다운로드한 패키지를 `node_modules` 디렉토리에 압축 해제하고 설치합니다.
4. 바이너리 링크: 필요한 경우 `node_modules/.bin/` 디렉토리에 실행 파일에 대한 심볼릭 링크를 생성합니다.

## npx: 실행의 혁신

npx는 npm 5.2.0 버전부터 기본으로 제공되는 도구로, 주로 다음과 같은 목적으로 사용됩니다:

1. 로컬에 설치된 패키지의 명령어 실행
2. 일회성 명령어 실행 (패키지를 설치하지 않고)
3. 특정 버전의 Node.js로 스크립트 실행
4. GitHub gist나 레포지토리에서 직접 스크립트 실행

### npx의 내부 동작

npx가 명령어를 실행할 때의 프로세스를 살펴보겠습니다:

1. 명령어 검색: 먼저 로컬 `node_modules/.bin/` 디렉토리에서 명령어를 찾습니다.
2. 캐시 확인: 찾지 못한 경우, npx 캐시에서 명령어를 찾습니다.
3. 임시 설치: 여전히 찾지 못한 경우, npm 레지스트리에서 패키지를 임시로 설치합니다.
4. 실행 및 정리: 명령어를 실행하고, 임시로 설치한 패키지는 제거합니다.

## 고급 사용 사례 및 팁

1. **버전 관리의 미묘한 차이**
   npm은 `package.json`의 버전 범위를 사용하지만, npx는 항상 최신 버전을 사용합니다. 이는 때때로 예기치 않은 결과를 초래할 수 있습니다.

   ```bash
   # npm으로 특정 버전 설치
   npm install cowsay@1.4.0

   # npx로 최신 버전 실행
   npx cowsay "Hello"
   ```

2. **보안 고려사항**
   npx는 편리하지만, 신뢰할 수 없는 소스에서 코드를 실행할 위험이 있습니다. 항상 패키지의 출처를 확인하세요.

3. **성능 최적화**
   대규모 프로젝트에서 npm의 flat node_modules 구조는 중복 패키지로 인해 디스크 공간을 많이 차지할 수 있습니다. pnpm과 같은 대안을 고려해 볼 수 있습니다.

4. **CI/CD 파이프라인에서의 사용**
   npx는 CI/CD 환경에서 글로벌 패키지 설치 없이 도구를 실행할 때 유용합니다.

   ```yaml
   # GitHub Actions 예시
   steps:
     - uses: actions/checkout@v2
     - name: Use Node.js
       uses: actions/setup-node@v2
       with:
         node-version: "14"
     - run: npx prettier --check .
   ```

5. **복잡한 스크립트 실행**
   npm 스크립트와 npx를 조합하여 복잡한 작업을 간소화할 수 있습니다.

   ```json
   {
     "scripts": {
       "build": "npm run clean && npx webpack && npm run test",
       "clean": "rimraf dist",
       "test": "jest"
     }
   }
   ```

## 마치며

npm과 npx는 각각 고유한 장단점을 가지고 있습니다.

npm은 프로젝트의 의존성을 관리하고 일관된 개발 환경을 제공하는 데 탁월하며, npx는 일회성 작업이나 다양한 버전의 도구를 빠르게 실행하는 데 유용합니다.
